# Архитектура компьютера. Лабораторная работа №3

- Кожемякин Руслан Алексеевич, P3223
- alg -> asm | acc | neum | hw | instr | binary -> struct | stream | mem | pstr | prob1 | cache
- Базовый вариант

## Язык программирования

``` ebnf
<program> ::= <statement>

<statement> ::= <declaration>
              | <input_statement>
              | <print_statement>
              | <if_statement>
              | <while_statement>

<declaration>     ::= <type> <name> "=" <expression> <nl>
<input_statement> ::= "<<" <name> <nl>
<print_statement> ::= ">>" <expression> <nl>
<if_statement>    ::= "if" "(" <expression> ")" "{" <program> "}" <nl>
<while_statement> ::= "while" "(" <expression> ")" "{" <program> "}" <nl>

<expression> ::= <term> | <expression> ( <binary_op> | <comparison_op> ) <expression>
<term> ::= <name>
         | <string_literal>
         | <number>
         | <expression>

<type>           ::= "int" | "string"
<name>           ::= "[_a-zA-Z]\w*"
<string_literal> ::= "[^"]*"
<number>         ::= "[+-]?[0-9]\d*|0"
<nl>             ::= "\n"

<binary_op>     ::= "+" | "-" | "*" | "/" | "%"
<comparison_op> ::= "==" | "!=" | ">" | "<" | ">=" | "<="

comment         ::= "//" <any symbols except "\n">
```
Код выполняется последовательно. Операции:
- `+` бинарное сложение
- `-` бинарное вычитание
- `*` умножение
- `/` целочисленное деление
- `%` остаток от деления
- `>` сравнение(больше)
- `>=` сравнение(больше, либо равно)
- `<` сравнение(меньше)
- `<=` сравнение(меньше, либо равно)
- `==` сравнение(равенство)
- `!=` сравнение(неравенство)

В языке реализованны следующие возможности:
- Память выделяется статически, при запуске модели. Видимость данных -- глобальная. Поддержка литералов -- строковая, числовая.
- Тип данных указывается явно, статическая типизация данных.
- Условие `if` и цикл `while`.
- Основные математические выражения, логические выражения, условные выражения.
- Ввод/вывод данных.
- Каждая строчка кода заканчивает с "\n"

## Организация памяти
Архитектура Фон Неймана
- Память иснтрукций и данных общая.
- Машинное слово 32 бита, знаковое
- Инструкции хранятся с ячейки 00, далее данные, последние 2 ячейки выделены для ввода/вывода
- 
```
         Memory
+---------------------+
|  00  :     jmp      |
|  01  :  instruction |
|  02  :  instruction |
|  ...       ...      |
|  b   :   variable   |
|  b+1 :   variable   |
|  ...       ...      |
|  i-1 :    input     |
|  i   :    output    |
+---------------------+
```

## Система команд
Особенности процессора:
- Машинное слово 32 бита, знаковое
- Регистры:
  - A -- хранит результаты вычислений, определяет флаги N и Z.
  - PC -- счетчик команд, также используется при переходах.
  - RA -- хранит адрес ячейки памяти с которой происходит взаимодействие.
- Ввод/вывод - stream, занимает последние 2 ячейки памяти.

### Набор инструкций
| Инструкция | Такты          | Описание                                    |
|------------|--------------|---------------------------------------------|
| HLT        |   | Останов                 |
| CLA        |   | Очистить A                 |
| LD M       |      | Загрузка M в A                            |
| ST M       |             | Сохранение значения из A в M              |
| ADD M      |             | Сложить значение M с A                    |
| SUB M      |            | Вычесть                                     |
| MUL M      |             | Умножить                                    |
| DIV M      |             | Разделить                                   |
| MOD M      |             | Взять остаток от деления A на M           |
| CMP M      |             | Установить флаги от операции A - M        |
| JMP M      |     | Перейти на инструкцию M                     |
| BEQ M       |             | Переход, если флаг Z = 1                    |
| BNE M      |             | Переход, если флаг Z = 0                    |
| BGE M       |             | Переход, если флаг N = 1                    |
| BG M       |             | Переход, если флаг N = 0 и Z = 0            |

- `A` - аккумуляторный регистр.
- Флаг `Z` - результат операции равен 0.
- Флаг `N` - результат операции отрицательный.
- Все **адресные команды** поддерживают прямую и непосредственную адресацию.  
  Команды LD и ST дополнительно поддерживают косвенную адресацию.
- `M` - адрес в памяти.
- `P` - номер порта ввода/вывода.

### Кодирование инструкций
Бинарное кодирование инструкций


## Транслятор

### Правила генерации машинного кода

## Модель процессора

### ControlUnit

Сигналы:

Особенности работы модели:

### DataPath

## Тестирование
Тестирование выполняется при помощи golden test-ов. Тесты и конфигурации в формате yaml находятся в папке:

Запуск тестов: `poetry run pytest -v`  
Обновление конфигурации golden test-ов: `poetry run pytest -v --update-goldens`

Пример использования и журнал работы процессора на примере `cat`:
``` shell

```

Пример проверки исходного кода:
``` shell

```

## Статистика
| ФИО                         | алг             | LoC | code байт | code инстр. | инстр. | такт. |
|-----------------------------|-----------------|-----|-----------|-------------|--------|-------|
| Кожемякин Руслан Алексеевич | hello           |    |        |          |     |    |
| Кожемякин Руслан Алексеевич | cat             |    |        |          |    |   |
| Кожемякин Руслан Алексеевич | prob1           |    |        |           |   |  |
